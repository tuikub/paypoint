<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ ‡∏ï‡∏±‡∏ß‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏≠‡∏ó (n8n Tester)</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; padding-top: 50px; }
        .card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 450px; }
        h2 { text-align: center; color: #333; margin-bottom: 20px; }
        label { font-weight: bold; display: block; margin-top: 15px; color: #555; }
        input, textarea { width: 100%; padding: 12px; margin-top: 8px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        input:focus, textarea:focus { border-color: #007bff; outline: none; }
        
        button { width: 100%; background-color: #007bff; color: white; border: none; padding: 12px; border-radius: 8px; font-size: 16px; margin-top: 25px; cursor: pointer; transition: 0.3s; font-weight: bold; }
        button:hover { background-color: #0056b3; }
        
        #result { margin-top: 25px; padding: 20px; border-radius: 10px; min-height: 80px; text-align: center; border: 2px dashed #ccc; background: #f8f9fa; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 10px; transition: all 0.3s ease; }
        
        /* Status Styles */
        .status-badge { font-size: 24px; font-weight: bold; padding: 8px 20px; border-radius: 50px; display: inline-block; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        .result-success { background-color: #d4edda !important; border: 2px solid #28a745 !important; color: #155724; }
        .result-success .status-badge { background-color: #28a745; color: white; }
        
        .result-error { background-color: #f8d7da !important; border: 2px solid #dc3545 !important; color: #721c24; }
        .result-error .status-badge { background-color: #dc3545; color: white; }
        
        .result-loading { background-color: #e2e3e5 !important; border: 2px solid #6c757d !important; color: #383d41; }

        .provider-tag { font-size: 12px; background: rgba(0,0,0,0.1); padding: 4px 10px; border-radius: 4px; margin-top: 5px; font-weight: bold; }
    </style>
</head>
<body>

<div class="card">
    <h2>üß™ ‡∏ï‡∏±‡∏ß‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏≠‡∏ó (Visual Mode)</h2>
    
    <label>1. ‡∏ß‡∏≤‡∏á URL ‡∏Ç‡∏≠‡∏á n8n ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ:</label>
    <input type="text" id="url" placeholder="‡πÄ‡∏ä‡πà‡∏ô https://.../webhook-test/chat">
    
    <label>2. ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡∏ö‡∏≠‡∏ó:</label>
    <textarea id="msg" rows="3" placeholder="‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ AI..."></textarea>
    
    <button onclick="send()">üöÄ ‡∏Å‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö (Start Test)</button>
    
    <label>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</label>
    <div id="result">
        <span style="color: #888;">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...</span>
    </div>
</div>

<script>
    async function send() {
        const url = document.getElementById('url').value.trim();
        const msg = document.getElementById('msg').value;
        const resultBox = document.getElementById('result');

        if(!url) { alert("‚ö†Ô∏è ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á n8n ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö!"); return; }
        if(!msg) { alert("‚ö†Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö"); return; }
        
        // Reset state to Loading
        resultBox.className = 'result-loading';
        resultBox.innerHTML = `
            <div class="status-badge" style="background:#6c757d;">‚è≥ LOADING...</div>
            <div>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏´‡∏≤ n8n...<br><small>(‡∏ñ‡πâ‡∏≤‡∏Ñ‡πâ‡∏≤‡∏á‡∏ô‡∏≤‡∏ô ‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Å‡∏î Execute ‡πÉ‡∏ô n8n ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á)</small></div>
        `;
        
        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: msg })
            });
            
            if (!response.ok) {
                throw new Error(`Server Error: ${response.status}`);
            }

            const data = await response.json();
            
            // Check if reply exists (Success Case)
            if (data.reply) {
                resultBox.className = 'result-success';
                let providerInfo = data.provider ? `<div class="provider-tag">‡∏ú‡∏π‡πâ‡∏ï‡∏≠‡∏ö: ${data.provider}</div>` : '';
                
                resultBox.innerHTML = `
                    <div class="status-badge">‚úÖ ‡∏ú‡πà‡∏≤‡∏ô (PASS)</div>
                    <div style="font-size: 1.2em; font-weight:bold;">"${data.reply}"</div>
                    ${providerInfo}
                `;
            } else {
                // Connected but weird response
                resultBox.className = 'result-error';
                resultBox.innerHTML = `
                    <div class="status-badge" style="background:#ffc107; color:black;">‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏Å‡πÜ</div>
                    <div>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á (‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ key "reply")</div>
                    <div style="font-size:0.8em; margin-top:5px;">${JSON.stringify(data)}</div>
                `;
            }
            
        } catch (error) {
            // Error State
            resultBox.className = 'result-error';
            resultBox.innerHTML = `
                <div class="status-badge">‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô (FAIL)</div>
                <div style="font-weight:bold;">‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏: ${error.message}</div>
                <div style="font-size: 0.9em; margin-top:10px; text-align:left; background:rgba(255,255,255,0.5); padding:10px; border-radius:5px;">
                    üí° <b>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ (‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠):</b><br>
                    1. ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <b>Execute Workflow</b> ‡πÉ‡∏ô n8n ‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏∏‡∏ô‡πÜ ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?<br>
                    2. ‡πÉ‡∏ô Webhook > Options > <b>CORS</b> ‡πÉ‡∏™‡πà‡∏î‡∏≠‡∏Å‡∏à‡∏±‡∏ô <code>*</code> ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?<br>
                    3. URL ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ <code>webhook-test</code> (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà webhook ‡πÄ‡∏â‡∏¢‡πÜ)
                </div>
            `;
        }
    }
</script>

</body>
</html>
