<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SABUY SPEED & WSOL - HR Smart Assistant</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #0056b3;
            --secondary-color: #00a8ff;
            --accent-color: #ff9f43;
            --bg-color: #f4f7f6;
            --chat-bg: #ffffff;
            --user-msg-bg: #0056b3;
            --bot-msg-bg: #e9ecef;
            --line-color: #06C755;
            --ai-color: #8e44ad; /* ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö AI */
        }

        body {
            font-family: 'Sarabun', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: #333;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
        }
        header h1 { margin: 0; font-size: 1.6em; }
        header p { margin: 5px 0 0; opacity: 0.9; font-size: 0.9em; }

        /* Internal Warning Badge */
        .internal-warning {
            background-color: #ffc107;
            color: #856404;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
            border: 1px solid #ffeeba;
        }

        /* Button Group */
        .header-buttons {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .btn-line { background-color: var(--line-color); }
        .btn-line:hover { background-color: #05a546; }
        
        .btn-mol { background-color: #e67e22; }
        .btn-mol:hover { background-color: #d35400; }

        .btn-key { background-color: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.4); }
        .btn-key:hover { background-color: rgba(255,255,255,0.3); }

        .container {
            max-width: 1000px;
            margin: 20px auto;
            padding: 0 15px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            padding: 20px;
            overflow: hidden;
            border-top: 5px solid var(--primary-color);
        }
        .card.sso-card { border-top-color: var(--accent-color); }
        .card.ai-card { border-top-color: var(--ai-color); }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        .header-left { display: flex; align-items: center; gap: 10px; }
        .section-header i { font-size: 1.4em; color: var(--primary-color); }
        .sso-card .section-header i { color: var(--accent-color); }
        .ai-card .section-header i { color: var(--ai-color); }
        
        .section-header h2 { margin: 0; color: #333; font-size: 1.2em; }
        
        /* Chat Interface */
        .chat-window {
            height: 400px;
            overflow-y: auto;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .message.user { flex-direction: row-reverse; }
        
        .avatar {
            width: 35px; height: 35px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 0.9em;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .bot .avatar { background-color: var(--ai-color); margin-right: 10px; }
        .user .avatar { background-color: var(--primary-color); margin-left: 10px; }

        .bubble {
            max-width: 80%;
            padding: 10px 14px;
            border-radius: 16px;
            font-size: 0.95em;
            line-height: 1.5;
            position: relative;
            word-wrap: break-word;
        }
        .bot .bubble { background-color: var(--bot-msg-bg); color: #333; border-top-left-radius: 2px; }
        .user .bubble { background-color: var(--user-msg-bg); color: white; border-top-right-radius: 2px; }

        /* Input Area */
        .input-area { display: flex; gap: 10px; position: relative; }
        .input-area input {
            flex: 1; padding: 12px 15px; padding-right: 50px;
            border: 2px solid #ddd; border-radius: 25px; outline: none;
            transition: border-color 0.3s;
        }
        .input-area input:focus { border-color: var(--ai-color); }
        .send-btn {
            position: absolute; right: 5px; top: 5px;
            width: 38px; height: 38px; border-radius: 50%;
            background-color: var(--ai-color); color: white;
            border: none; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }
        .send-btn:hover { background-color: #7d3c98; }

        /* Info Grid */
        .info-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;
        }
        .info-item {
            background: #fff; border-left: 4px solid #ddd; padding: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .card .info-item { border-left-color: var(--primary-color); }
        .sso-card .info-item { border-left-color: var(--accent-color); }

        .info-item h3 { margin: 0 0 5px; font-size: 1em; color: #444; display: flex; align-items: center; gap: 8px; }
        .info-item p { margin: 0; color: #666; font-size: 0.9em; }

        /* API Key Modal */
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);
            align-items: center; justify-content: center;
        }
        .modal-content {
            background-color: white; padding: 25px; border-radius: 10px;
            width: 90%; max-width: 400px; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .modal h3 { margin-top: 0; color: var(--ai-color); }
        .modal input { width: 100%; padding: 10px; margin: 10px 0; box-sizing: border-box; }
        .modal-btns { display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px; }
        .modal-btn { padding: 8px 16px; border-radius: 5px; border: none; cursor: pointer; }
        .btn-save { background-color: var(--ai-color); color: white; }
        .btn-cancel { background-color: #ddd; color: #333; }

        /* Status Indicator */
        .api-status { font-size: 0.8em; margin-left: 10px; }
        .status-ok { color: #2ecc71; }
        .status-off { color: #e74c3c; }

        /* Suggestions */
        .suggestions { margin-top: 10px; display: flex; flex-wrap: wrap; gap: 8px; }
        .chip {
            background-color: #f0ebf8; color: var(--ai-color);
            padding: 5px 10px; border-radius: 15px; font-size: 0.8em;
            cursor: pointer; transition: 0.2s;
        }
        .chip:hover { background-color: var(--ai-color); color: white; }
    </style>
</head>
<body>

<header>
    <div class="internal-warning"><i class="fas fa-lock"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏¢‡πÉ‡∏ô (Internal Only)</div>
    <h1><i class="fas fa-brain"></i> HR Smart Assistant</h1>
    <p>‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡πÅ‡∏•‡∏∞‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô</p>

    <div class="header-buttons">
        <a href="https://lin.ee/g7U9w4i" target="_blank" class="action-btn btn-line">
            <i class="fab fa-line"></i> ‡πÅ‡∏≠‡∏î‡πÑ‡∏•‡∏ô‡πå HR
        </a>
        <a href="https://apigateway.mol.go.th/" target="_blank" class="action-btn btn-mol">
            <i class="fas fa-external-link-alt"></i> ‡πÄ‡∏ß‡πá‡∏ö‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô
        </a>
        <button onclick="openKeyModal()" class="action-btn btn-key">
            <i class="fas fa-key"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API Key <span id="apiStatus" class="api-status status-off">‚óè</span>
        </button>
    </div>
</header>

<div class="container">

    <!-- AI Chat Section -->
    <div class="card ai-card">
        <div class="section-header">
            <div class="header-left">
                <i class="fas fa-robot"></i>
                <h2>‡∏ñ‡∏≤‡∏°-‡∏ï‡∏≠‡∏ö ‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ & ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏° (AI)</h2>
            </div>
            <button onclick="clearChat()" style="border:none; background:none; color:#999; cursor:pointer;">
                <i class="fas fa-trash"></i> ‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ä‡∏ó
            </button>
        </div>
        
        <div class="chat-window" id="chatWindow">
            <div class="message bot">
                <div class="avatar"><i class="fas fa-robot"></i></div>
                <div class="bubble">
                    ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏ú‡∏°‡∏Ñ‡∏∑‡∏≠ HR AI Assistant ü§ñ<br>
                    ‡∏ú‡∏°‡∏£‡∏π‡πâ‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô/‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß<br>
                    <small style="color: #666;">*‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <b>"‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API Key"</b> ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô ‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà‡∏Ñ‡∏µ‡∏¢‡πå Gemini ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏°‡∏â‡∏•‡∏≤‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö!</small>
                </div>
            </div>
        </div>

        <div class="input-area">
            <input type="text" id="userInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°... (‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏¥‡∏Å‡∏à‡πâ‡∏≤‡∏á, ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏ß‡πà‡∏≤‡∏á‡∏á‡∏≤‡∏ô)" onkeypress="handleKeyPress(event)">
            <button class="send-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
        </div>
        
        <div class="suggestions">
            <span class="chip" onclick="quickAsk('‡πÄ‡∏•‡∏¥‡∏Å‡∏à‡πâ‡∏≤‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏ä‡∏î‡πÄ‡∏ä‡∏¢‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢')">‚öñÔ∏è ‡∏Ñ‡πà‡∏≤‡∏ä‡∏î‡πÄ‡∏ä‡∏¢‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢</span>
            <span class="chip" onclick="quickAsk('‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏°.33 ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á')">üè• ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥ ‡∏°.33</span>
            <span class="chip" onclick="quickAsk('‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î‡πÑ‡∏î‡πâ‡∏Å‡∏µ‡πà‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏´‡∏°')">üë∂ ‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î & ‡πÄ‡∏á‡∏¥‡∏ô‡∏ä‡πà‡∏ß‡∏¢</span>
            <span class="chip" onclick="quickAsk('‡∏•‡∏∑‡∏°‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡πÑ‡∏á')">‚è∞ ‡∏•‡∏∑‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡∏ô‡∏¥‡πâ‡∏ß (‡∏†‡∏≤‡∏¢‡πÉ‡∏ô)</span>
        </div>
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏° (Static) -->
    <div class="card sso-card">
        <div class="section-header">
            <div class="header-left">
                <i class="fas fa-shield-alt"></i>
                <h2>‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô)</h2>
            </div>
        </div>
        <div class="info-grid">
            <div class="info-item">
                <h3><i class="fas fa-tooth"></i> ‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°</h3>
                <p>900 ‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢)</p>
            </div>
            <div class="info-item">
                <h3><i class="fas fa-briefcase"></i> ‡∏ß‡πà‡∏≤‡∏á‡∏á‡∏≤‡∏ô (‡∏•‡∏≤‡∏≠‡∏≠‡∏Å)</h3>
                <p>‡∏£‡∏±‡∏ö 30% ‡∏Ç‡∏≠‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (90 ‡∏ß‡∏±‡∏ô)</p>
            </div>
            <div class="info-item">
                <h3><i class="fas fa-user-injured"></i> ‡∏ß‡πà‡∏≤‡∏á‡∏á‡∏≤‡∏ô (‡πÄ‡∏•‡∏¥‡∏Å‡∏à‡πâ‡∏≤‡∏á)</h3>
                <p>‡∏£‡∏±‡∏ö 50% ‡∏Ç‡∏≠‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (180 ‡∏ß‡∏±‡∏ô)</p>
            </div>
             <div class="info-item">
                <h3><i class="fas fa-baby"></i> ‡∏Ñ‡∏•‡∏≠‡∏î‡∏ö‡∏∏‡∏ï‡∏£</h3>
                <p>‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πà‡∏≤‡∏¢ 15,000 + 50% ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (90‡∏ß‡∏±‡∏ô)</p>
            </div>
        </div>
    </div>

    <!-- ‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô -->
    <div class="card">
        <div class="section-header">
            <div class="header-left">
                <i class="fas fa-building"></i>
                <h2>‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô (Internal Rules)</h2>
            </div>
        </div>
        <div class="info-grid">
            <div class="info-item">
                <h3><i class="far fa-clock"></i> ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</h3>
                <p>‡∏à-‡∏® (08.30-17.30)</p>
            </div>
            <div class="info-item">
                <h3><i class="fas fa-fingerprint"></i> ‡∏•‡∏∑‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡∏ô‡∏¥‡πâ‡∏ß</h3>
                <p>‡πÅ‡∏à‡πâ‡∏á HR ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡πÄ‡∏ß‡∏•‡∏≤</p>
            </div>
             <div class="info-item">
                <h3><i class="fas fa-envelope-open-text"></i> ‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</h3>
                <p>‡πÅ‡∏à‡πâ‡∏á‡∏Å‡πà‡∏≠‡∏ô 10.00 ‡∏ô.</p>
            </div>
        </div>
    </div>

</div>

<!-- API Key Modal -->
<div id="keyModal" class="modal">
    <div class="modal-content">
        <h3>üîë ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Gemini API Key</h3>
        <p style="font-size: 0.9em; color: #666;">‡πÉ‡∏™‡πà API Key ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏ï‡∏≠‡∏ö‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô (‡∏ü‡∏£‡∏µ)</p>
        <input type="password" id="apiKeyInput" placeholder="‡∏ß‡∏≤‡∏á API Key ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà (AIzaSy...)">
        <div class="modal-btns">
            <button class="modal-btn btn-cancel" onclick="closeKeyModal()">‡∏õ‡∏¥‡∏î</button>
            <button class="modal-btn btn-save" onclick="saveApiKey()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
        <p style="font-size: 0.8em; margin-top:10px;"><a href="https://aistudio.google.com/app/apikey" target="_blank">‡∏£‡∏±‡∏ö Key ‡∏ü‡∏£‡∏µ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</a></p>
    </div>
</div>

<script>
    // Local Knowledge Base (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó)
    const localDatabase = [
        { keywords: ["‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤", "‡∏™‡πÅ‡∏Å‡∏ô‡∏ô‡∏¥‡πâ‡∏ß", "‡∏•‡∏∑‡∏°‡∏ï‡∏≠‡∏Å‡∏ö‡∏±‡∏ï‡∏£"], answer: "üìå **‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô**: ‡∏Å‡∏£‡∏ì‡∏µ‡∏•‡∏∑‡∏°‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ **'‡∏Ç‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô'** ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏£‡∏±‡∏ö" },
        { keywords: ["‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô", "‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏Å‡∏µ‡πà‡πÇ‡∏°‡∏á"], answer: "üìå **‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô**: ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå-‡∏®‡∏∏‡∏Å‡∏£‡πå 08.30 - 17.30 ‡∏ô. ‡∏Ñ‡∏£‡∏±‡∏ö" },
        { keywords: ["‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢", "‡∏õ‡πà‡∏ß‡∏¢"], answer: "üìå **‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô**: ‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 10.00 ‡∏ô. ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏´‡∏≤‡∏Å‡∏•‡∏≤ 3 ‡∏ß‡∏±‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏Ñ‡∏£‡∏±‡∏ö" },
        { keywords: ["‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ hr", "‡πÄ‡∏ö‡∏≠‡∏£‡πå hr"], answer: "üìå **‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠**: ‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• ‡∏ä‡∏±‡πâ‡∏ô 2 ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏≠‡∏î‡πÑ‡∏•‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö" }
    ];

    let geminiApiKey = "";

    // Load API Key from LocalStorage
    window.onload = function() {
        const storedKey = localStorage.getItem("gemini_api_key");
        if (storedKey) {
            geminiApiKey = storedKey;
            updateApiStatus(true);
        }
    };

    function updateApiStatus(active) {
        const statusDot = document.getElementById("apiStatus");
        if (active) {
            statusDot.classList.remove("status-off");
            statusDot.classList.add("status-ok");
            statusDot.style.color = "#2ecc71";
        } else {
            statusDot.classList.remove("status-ok");
            statusDot.classList.add("status-off");
            statusDot.style.color = "#e74c3c";
        }
    }

    function openKeyModal() { document.getElementById("keyModal").style.display = "flex"; }
    function closeKeyModal() { document.getElementById("keyModal").style.display = "none"; }
    
    function saveApiKey() {
        const input = document.getElementById("apiKeyInput").value.trim();
        if (input) {
            geminiApiKey = input;
            localStorage.setItem("gemini_api_key", input);
            updateApiStatus(true);
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å API Key ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏±‡∏ö");
            closeKeyModal();
        }
    }

    async function sendMessage() {
        const inputField = document.getElementById("userInput");
        const message = inputField.value.trim();
        if (!message) return;

        addMessage(message, 'user');
        inputField.value = '';
        
        // 1. Check Local DB First (Priority to Internal Rules)
        const localMatch = checkLocalDB(message);
        if (localMatch) {
            setTimeout(() => addMessage(localMatch, 'bot'), 500);
            return;
        }

        // 2. Use Gemini AI for General/Law Questions
        if (geminiApiKey) {
            addMessage("... ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö ...", 'bot', true); // Loading state
            try {
                const aiResponse = await callGeminiAPI(message);
                removeLoadingMessage();
                addMessage(aiResponse, 'bot');
            } catch (error) {
                removeLoadingMessage();
                addMessage("‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ AI (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API Key ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ô‡πá‡∏ï‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)", 'bot');
            }
        } else {
            addMessage("‚ö†Ô∏è **‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏™‡πà API Key**: ‡∏ú‡∏°‡∏ï‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏é‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô/‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° **'‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API Key'** ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö", 'bot');
        }
    }

    function checkLocalDB(query) {
        const lowerQuery = query.toLowerCase();
        for (let item of localDatabase) {
            if (item.keywords.some(k => lowerQuery.includes(k))) {
                return item.answer;
            }
        }
        return null;
    }

    async function callGeminiAPI(userPrompt) {
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${geminiApiKey}`;
        
        const systemPrompt = "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡πÑ‡∏ó‡∏¢‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏° ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Å‡∏±‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó SABUY SPEED ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡πÑ‡∏ó‡∏¢‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô '‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô'";
        
        const requestBody = {
            contents: [{
                parts: [{ text: systemPrompt + "\n\nUser Question: " + userPrompt }]
            }]
        };

        const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(requestBody)
        });

        const data = await response.json();
        return data.candidates[0].content.parts[0].text;
    }

    function addMessage(text, sender, isLoading = false) {
        const chatWindow = document.getElementById("chatWindow");
        const msgDiv = document.createElement("div");
        msgDiv.className = `message ${sender}`;
        if (isLoading) msgDiv.id = "loadingMsg";
        
        let avatarIcon = sender === 'bot' ? '<i class="fas fa-robot"></i>' : '<i class="fas fa-user"></i>';
        
        // Format Markdown Bold
        let formattedText = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>').replace(/\n/g, '<br>');

        msgDiv.innerHTML = `
            <div class="avatar">${avatarIcon}</div>
            <div class="bubble">${formattedText}</div>
        `;
        
        chatWindow.appendChild(msgDiv);
        chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    function removeLoadingMessage() {
        const loadingMsg = document.getElementById("loadingMsg");
        if (loadingMsg) loadingMsg.remove();
    }

    function handleKeyPress(e) { if (e.key === 'Enter') sendMessage(); }
    function quickAsk(q) { document.getElementById("userInput").value = q; sendMessage(); }
    function clearChat() {
        document.getElementById("chatWindow").innerHTML = `
            <div class="message bot">
                <div class="avatar"><i class="fas fa-robot"></i></div>
                <div class="bubble">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö!</div>
            </div>`;
    }
</script>

</body>
</html>
