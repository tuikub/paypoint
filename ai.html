<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (Brain via n8n)</title>
    <!-- ‡πÉ‡∏ä‡πâ Tailwind CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ‡πÉ‡∏ä‡πâ Marked.js ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏õ‡∏•‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ (‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤, ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠, ‡∏•‡∏¥‡∏™‡∏ï‡πå) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- ‡πÉ‡∏ä‡πâ Highlight.js ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏ó‡∏£‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap');
        
        body { font-family: 'Sarabun', sans-serif; background-color: #f3f4f6; color: #1f2937; }
        
        /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #e5e7eb; }
        ::-webkit-scrollbar-thumb { background: #9ca3af; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }

        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• Markdown */
        .markdown-body {
            color: #374151;
            line-height: 1.7;
            font-size: 1rem;
        }
        .markdown-body h1, .markdown-body h2, .markdown-body h3 {
            color: #111827;
            font-weight: 600;
            margin-top: 1em;
            margin-bottom: 0.5em;
        }
        .markdown-body p { margin-bottom: 1em; }
        .markdown-body ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1em; }
        .markdown-body ol { list-style-type: decimal; padding-left: 1.5em; margin-bottom: 1em; }
        .markdown-body strong { color: #000; font-weight: 700; }
        
        /* ‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ */
        .markdown-body pre {
            background-color: #1f2937 !important;
            color: #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            overflow-x: auto;
            margin-bottom: 1em;
        }
        .markdown-body code {
            font-family: monospace;
            background-color: #e5e7eb;
            color: #c026d3; /* ‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π‡πÄ‡∏Ç‡πâ‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Inline Code */
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-body pre code {
            background-color: transparent;
            color: inherit;
            padding: 0;
        }
    </style>
</head>
<body class="h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-br from-indigo-50 to-blue-100">

    <!-- Container ‡∏´‡∏•‡∏±‡∏Å -->
    <div class="w-full max-w-4xl h-[90vh] flex flex-col bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
        
        <!-- Header -->
        <div class="bg-indigo-600 p-4 text-white flex items-center justify-between shadow-md z-10">
            <h1 class="text-xl font-bold flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" /></svg>
                AI Assistant (‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß)
            </h1>
            <div class="text-xs bg-indigo-500 px-3 py-1 rounded-full text-indigo-100">Powered by Gemini via n8n</div>
        </div>

        <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤ (Output) -->
        <div class="flex-1 bg-gray-50 p-6 overflow-y-auto relative custom-scroll flex flex-col gap-4" id="chatContainer">
            
            <!-- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö -->
            <div class="self-start bg-white p-4 rounded-2xl rounded-tl-none shadow-sm border border-gray-200 max-w-[85%]">
                <p class="text-gray-700">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! üëã ‡∏ú‡∏°‡∏Ñ‡∏∑‡∏≠ AI ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì<br>‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ú‡∏°‡∏ä‡πà‡∏ß‡∏¢‡∏´‡∏≤‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö ‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ñ‡∏≤‡∏°‡∏°‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö</p>
            </div>

            <!-- Loading Spinner (‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà) -->
            <div id="loadingSpinner" class="hidden self-start bg-white p-4 rounded-2xl rounded-tl-none shadow-sm border border-gray-200 flex items-center gap-3">
                <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-indigo-600"></div>
                <span class="text-gray-500 text-sm animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö...</span>
            </div>

            <!-- ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
        </div>

        <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (Input) -->
        <div class="bg-white p-4 border-t border-gray-200 shadow-lg z-20">
            <div class="relative flex gap-2 items-end">
                <textarea id="promptInput" 
                    class="w-full bg-gray-100 text-gray-800 p-3 pl-4 rounded-2xl border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none resize-none text-base leading-relaxed placeholder-gray-400 transition-all shadow-inner"
                    rows="2"
                    placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà... (‡∏Å‡∏î Ctrl+Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á)"></textarea>
                
                <button onclick="sendRequest()" id="sendBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white p-4 rounded-full shadow-lg transition-all transform hover:scale-105 flex-shrink-0 mb-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" /></svg>
                </button>
            </div>
            <div class="text-xs text-center mt-2 text-gray-400">
                ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ, ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì, ‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÅ‡∏•‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ
            </div>
        </div>
    </div>

    <!-- Script ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô -->
    <script>
        // üü¢üü¢ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL ‡∏Ç‡∏≠‡∏á n8n ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ üü¢üü¢
        const N8N_WEBHOOK_URL = "https://n8n.srv1265116.hstgr.cloud/webhook/chat"; 

        async function sendRequest() {
            const promptInput = document.getElementById('promptInput');
            const chatContainer = document.getElementById('chatContainer');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const sendBtn = document.getElementById('sendBtn');

            const message = promptInput.value.trim();
            if (!message) return;

            // 1. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏•‡∏á‡πÉ‡∏ô‡πÅ‡∏ä‡∏ó
            appendUserMessage(message);
            promptInput.value = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ä‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå
            promptInput.style.height = 'auto'; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á

            // 2. ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏´‡∏•‡∏î
            loadingSpinner.classList.remove('hidden');
            // ‡∏¢‡πâ‡∏≤‡∏¢ Spinner ‡πÑ‡∏õ‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î
            chatContainer.appendChild(loadingSpinner);
            scrollToBottom();
            
            sendBtn.disabled = true;
            sendBtn.classList.add('opacity-50', 'cursor-not-allowed');

            try {
                // 3. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏´‡∏≤ n8n Webhook
                const response = await fetch(N8N_WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: message })
                });

                if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);

                const data = await response.json();
                
                // ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á text, output, reply)
                const aiText = data.text || data.output || data.reply || JSON.stringify(data);

                // 4. ‡∏ã‡πà‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö AI
                loadingSpinner.classList.add('hidden');
                appendAIMessage(aiText);

            } catch (error) {
                console.error("Error:", error);
                loadingSpinner.classList.add('hidden');
                appendAIMessage(`‚ùå **‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:** ${error.message}\n\n*‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡πÄ‡∏ä‡πá‡∏Ñ URL n8n ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ CORS*`, true);
            } finally {
                sendBtn.disabled = false;
                sendBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                scrollToBottom();
            }
        }

        function appendUserMessage(text) {
            const chatContainer = document.getElementById('chatContainer');
            const div = document.createElement('div');
            div.className = "self-end bg-indigo-600 text-white p-4 rounded-2xl rounded-tr-none shadow-md max-w-[85%] markdown-body";
            div.style.color = "white"; // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
            div.innerHTML = text.replace(/\n/g, '<br>');
            chatContainer.appendChild(div);
            scrollToBottom();
        }

        function appendAIMessage(markdownText, isError = false) {
            const chatContainer = document.getElementById('chatContainer');
            const div = document.createElement('div');
            div.className = `self-start bg-white p-4 rounded-2xl rounded-tl-none shadow-sm border border-gray-200 max-w-[85%] markdown-body ${isError ? 'border-red-300 bg-red-50' : ''}`;
            
            // ‡πÅ‡∏õ‡∏•‡∏á Markdown ‡πÄ‡∏õ‡πá‡∏ô HTML
            div.innerHTML = marked.parse(markdownText);
            
            chatContainer.appendChild(div);
            
            // Highlight Code ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
            div.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });

            scrollToBottom();
        }

        function scrollToBottom() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Auto resize textarea
        const tx = document.getElementById('promptInput');
        tx.addEventListener("input", function(){
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + "px";
            if(this.value === '') this.style.height = 'auto';
        });

        // ‡∏Å‡∏î Ctrl+Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á
        tx.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                sendRequest();
            }
        });
    </script>
</body>
</html>
